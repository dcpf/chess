<!DOCTYPE html>
<!-- Copyright (c) 2000 - 2013 dpf, dpf@theworld.com -->
<html lang="en">
<!-- 
TODO:
* create game
* email move
-->
<head>
    <meta charset="utf-8" />
    <title>Dave's Chess</title>
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css">
    <link rel="stylesheet" href="css/chess.css" />
</head>
<body style="padding: 20px">

    <div id="moveHistoryContainer" style="visibility: hidden">
        <div id="replayGameLink"><a href="#">Auto-Replay</a></div>
        <table id="moveHistoryTable">
            <tr>
                <th style="border-bottom: none; width: 20px;"></th>
                <th style="border-right: solid 1px #000">White</th>
                <th>Black</th>
            </tr>
        </table>
    </div>

    <div style="display: inline-block">
        <div id="chessBoardContainer"></div>
        <div id="messageContainer"></div>
        <fieldset id="capturedPiecesContainer" style="visibility: hidden">
            <legend>Captured Pieces</legend>
            <div id="capturedBlackPieces"></div>
            <div id="capturedWhitePieces"></div>
        </fieldset>
    </div>

</body>

<div id="confirmMoveDialog" class="modal hide" role="dialog" aria-hidden="true" data-backdrop="static">
    <div class="modal-body">
        <p>Please verify your move</p>
        <div id="possibleMoves"></div>
    </div>
</div>

<div id="chessBoardSnapshotDialog" class="modal hide" role="dialog" aria-hidden="true" data-backdrop="static">
    <div class="modal-body">
        <div style="text-align: right"><a href="#" class="closeIcon">Close</a></div>
        <div class="move"></div>
        <div id="chessBoardSnapshotContainer"></div>
    </div>
    <div id="tempPiecePlaceHolder"></div>
</div>

<script>
window.oncontextmenu = function () {return false;};
function log (msg) {
    if (window.console) {
        console.log(msg);
    }
}
</script>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>

<script src="js/util/eventHandler.js"></script>
<script src="js/util/notationConverter.js"></script>
<script src="js/model/piece.js"></script>
<script src="js/collection/capturedPieces.js"></script>
<script src="js/model/board.js"></script>
<script src="js/collection/moveHistory.js"></script>
<script src="js/view/boardView.js"></script>
<script src="js/view/boardSnapshotView.js"></script>
<script src="js/view/confirmMoveDialogView.js"></script>
<script src="js/view/capturedPiecesView.js"></script>
<script src="js/view/moveHistoryView.js"></script>
<script src="js/view/messagesView.js"></script>
<script src="js/util/initializer.js"></script>

<script>

// instantiate the chessGame object
var chessGame = {};
chess.initializer.initialize(chessGame);

// kick things off
chessGame.board.findAllLegalMoves();
chessGame.boardView.render();

// If there is an existing move history, use it to get the game into the current state
//var moveHistory = ['Pe2 e4', 'Pf7 f5', 'Pe4xf5', 'Pg7 g5', 'Pf5xg6 e.p.', 'Ph7xg6'];
var gameID = '<%= gameID %>';
if (window.moveHistory) {
    for (var i in moveHistory) {
        var notation = moveHistory[i];
        var moveArray = chessGame.notationConverter.convertNotation(chessGame.board, notation, i);
        for (var j in moveArray) {
            var move = moveArray[j];
            chessGame.boardView.doMove(move.piece.id, move.toRow, move.toCol, false);
            chessGame.boardView.updateGameWithLatestMove(notation, move.piece.id, move.toRow, move.toCol);
        }
    }
}

// Show hidden widgets
$('#moveHistoryContainer').css('visibility', 'visible');
$('#capturedPiecesContainer').css('visibility', 'visible');


</script>

</html>
